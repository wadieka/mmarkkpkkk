<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£è³¼è¨‚è³¼è¡¨å–®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .cart-float {
            box-shadow: 0 -10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
        }
        .cart-details-max-h {
            max-height: 250px;
            overflow-y: auto;
        }
        .required-label::after {
            content: " *";
            color: #ef4444;
        }
        .input-error {
            border-color: #ef4444 !important;
            background-color: #fef2f2;
        }
        .btn-pop {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .btn-pop:active {
            transform: scale(0.95);
        }
        .description-text {
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .description-text a {
            color: #2563eb;
            text-decoration: underline;
            font-weight: 600;
        }
        .description-text a:hover {
            color: #1d4ed8;
        }
        .product-note {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.5rem;
            line-height: 1.4;
            background-color: #f9fafb;
            padding: 0.5rem;
            border-radius: 0.5rem;
        }
        .qty-control {
            display: flex;
            align-items: center;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            background: #f9fafb;
        }
        .qty-btn {
            padding: 0.5rem 1rem;
            background: #fff;
            font-weight: bold;
            transition: background 0.2s;
        }
        .qty-btn:hover {
            background: #f3f4f6;
        }
        .qty-val {
            width: 3rem;
            text-align: center;
            font-weight: bold;
            font-size: 0.875rem;
        }
    </style>
</head>
<body class="bg-gray-50 pb-64">
    <div class="max-w-md mx-auto p-4">
        <header class="text-center py-6">
            <h1 class="text-2xl font-bold text-gray-800">ä»£è³¼å•†å“è¨‚è³¼å–®</h1>
            <div class="description-text text-gray-500 mt-4 text-sm text-left bg-white p-4 rounded-lg border border-dashed border-gray-300">
ã€è¨‚è³¼é ˆçŸ¥ã€‘
ğŸ‘‰ä¸»è¦åƒåŠ 1/24å ´ï¼ŒæœƒæŠ•ç°½å”®
ğŸ‘‰éƒ¨åˆ†å•†å“çš†æœ‰é™åƒ¹ï¼Œè©³ç´°è«‹è¦‹ä¸‹æ–¹é‡‘é¡ã€‚è¿‘æœŸæ³°éŠ–åŒ¯ç‡ä¸ä½³è«‹ç†è§£ã€‚
âœ…äººè‚‰æ‰›å›ï¼Œç„¡é ˆåœ‹éš›é‹è²»ã€‚æ³°åœ‹å“è³ªè«‹ç†è§£ï¼Œä¸å› ä»»ä½•ç‘•ç–µå•é¡Œé€€è²¨ï¼Œè‹¥æœ‰ç¼ºè²¨æƒ…æ³ç™¼ç”Ÿæœƒå…¨é¡é€€æ¬¾ã€‚
âœ…å›åœ‹å¾Œèµ°è³£è²¨ä¾¿20+38ï¼Œä¸å…§é€€ã€‚æœƒä½¿ç”¨äºŒæ‰‹åŒ…æï¼Œä»‹æ„è€…è«‹ç¹é“ã€‚
âœ…å…ˆåŒ¯æ¬¾ï¼Œå¾Œå¡«å–®ï¼›å¡«å–®å®Œæˆå³è¦–ç‚ºè³¼è²·ï¼Œæ•ä¸å¾—å–æ¶ˆå”·ã€‚

ğŸ’°åŒ¯æ¬¾å¸³è™Ÿ:
å°æ–°(812) 28881019124887
ğŸ’°<a href="https://docs.google.com/spreadsheets/d/1cnLagIAqDdCZyUTd6kQZBSekL_c8RvmOwAlxC-LCIOs/edit?gid=917520651#gid=917520651" target="_blank">å°å¸³è¡¨é€£çµé»æˆ‘</a>

ç‚ºæ–¹ä¾¿ç®¡ç†ï¼Œè«‹è·Ÿåœ˜è€…å‹™å¿…åŠ å…¥ç¤¾ç¾¤ï¼Œç¼ºè²¨åˆ°è²¨å‡ºè²¨ç­‰æœ€æ–°æ¶ˆæ¯çš†æœƒæ–¼æ­¤ä¸€ä½µå‘ŠçŸ¥!
ğŸ‘‰<a href="https://line.me/ti/g2/hQDj2h3t7YEkhQtO6zck-48p4Y9nmVumrSja5w?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" target="_blank">é»é€™è£¡åŠ å…¥ç¤¾ç¾¤</a>

æœ‰ä»»ä½•å•é¡Œæ­¡è¿ IG (<a href="https://instagram.com/mmarkkpkkk" target="_blank">mmarkkpkkk</a>) æˆ–ç¤¾ç¾¤ç›´æ¥ @mmarkkpkkk æœ¬äººå–”
            </div>
        </header>

        <!-- è¯çµ¡è³‡è¨Šå€å¡Š (ä¿®æ­£ä½ç½®è‡³ä¸­é–“) -->
        <section class="bg-white rounded-xl p-4 mb-6 shadow-sm border border-gray-100">
            <h2 class="font-semibold text-lg mb-4 border-b pb-2 text-blue-600">è¯çµ¡è³‡è¨Š (å¿…å¡«)</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-600 mb-1 required-label">å°å¸³è¡¨åç¨±</label>
                    <input type="text" id="userName" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1 required-label">åŒ¯æ¬¾æ—¥æœŸ</label>
                    <input type="text" id="payDate" placeholder="è«‹è¼¸å…¥æ—¥æœŸ (å¦‚: 01/20)" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1 required-label">åŒ¯æ¬¾é‡‘é¡</label>
                    <input type="number" id="payAmount" placeholder="è«‹è¼¸å…¥ç¸½é‡‘é¡" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1 required-label">è¯çµ¡è³‡è¨Š (IG)</label>
                    <input type="text" id="userIG" placeholder="è«‹è¼¸å…¥æ‚¨çš„ IG å¸³è™Ÿ" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                </div>
            </div>
        </section>
        
        <div id="productList" class="space-y-6"></div>

        <!-- åº•éƒ¨è³¼ç‰©è»Š -->
        <div class="fixed bottom-0 left-0 right-0 bg-white cart-float border-t z-40">
            <div id="cartDetails" class="max-w-md mx-auto px-4 py-3 border-b bg-gray-50 hidden">
                <div class="flex justify-between items-center mb-2">
                    <p class="text-xs font-bold text-gray-500 uppercase tracking-wider">å·²åŠ å…¥æ¸…å–®ï¼š</p>
                    <button onclick="toggleCartDetails()" class="text-gray-400 text-xs">æ”¶èµ· âœ•</button>
                </div>
                <div id="cartItemsList" class="cart-details-max-h space-y-2 mb-2"></div>
            </div>

            <div class="max-w-md mx-auto p-4 flex items-center justify-between">
                <div class="flex-1">
                    <p class="text-sm text-gray-500 flex items-center gap-1">
                        ç¸½è¨ˆ <span id="totalItems" class="text-blue-600 font-bold">0</span> ä»¶å•†å“
                        <button id="viewDetailBtn" onclick="toggleCartDetails()" class="text-blue-500 text-xs underline ml-2">æŸ¥çœ‹/èª¿æ•´æ˜ç´°</button>
                    </p>
                    <p class="text-xl font-bold text-red-500">ç¸½é‡‘é¡: $<span id="totalPrice">0</span></p>
                </div>
                <button id="submitBtn" onclick="submitOrder()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-xl font-bold transition-all btn-pop shadow-lg shadow-blue-200">
                    æäº¤è¨‚å–®
                </button>
            </div>
        </div>

        <!-- æˆåŠŸæ¨¡æ…‹æ¡† -->
        <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
            <div class="bg-white p-8 rounded-2xl text-center max-w-sm w-full shadow-2xl">
                <div class="w-20 h-20 bg-green-100 text-green-500 rounded-full flex items-center justify-center text-5xl mx-auto mb-4">âœ“</div>
                <h3 class="text-xl font-bold mb-2">è¨‚å–®æäº¤æˆåŠŸï¼</h3>
                <p class="text-gray-600 mb-6">æˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„è¨‚å–®èˆ‡åŒ¯æ¬¾è³‡è¨Šï¼Œä¸¦å·²æ›´æ–°çµ±è¨ˆè¡¨ã€‚</p>
                <button onclick="location.reload()" class="w-full bg-blue-600 text-white px-6 py-3 rounded-xl font-bold">è¿”å›é¦–é </button>
            </div>
        </div>
    </div>

    <script>
        const products = [
            {
                id: 1,
                name: "é™„ç¹©è­‰ä»¶å¥—",
                price: 660,
                image: "https://i.ibb.co/k2YkHDmd/image.jpg",
                variants: ["KING MAN", "BABII", "POLCASAN", "MR. SATURNWORLD", "PAODY", "PERMPOON", "TOMAFOX", "JAIDEE", "AVOCEAN", "YUZU MUMU", "LOOK KHUNNOO", "SAMRUAY", "NONG NOOONG", "DOMIIA", "WESLEY", "JUMMO", "GUINZLY", "MOMO", "CERI", "MUVMUV", "LUNAR", "ANY", "METAA", "NILKNHAKE", "SMYLE", "NEONA", "LYKYOU"]
            },
            {
                id: 2,
                name: "å£“å…‹åŠ›ç£å¸å¡å¥—",
                price: 450,
                image: "https://i.ibb.co/JF5DYWQ6/image.jpg",
                variants: ["KristSingto", "OffGun", "TayNew", "EarthMix", "BounPrem", "PondPhuwin", "ForceBook", "JoongDunk", "JimmySea", "FirstKhaotung", "GeminiFourth", "WinnySatang", "SeaKeen", "PerthSanta", "WilliamEst", "JuniorMark", "JossGawin", "MarkOhm", "AouBoom", "MilkLove", "NamtanFilm", "EmiBonnie", "Win", "Nanon", "Sky", "Nani", "LYKN"]
            },
            {
                id: 3,
                name: "ç”·ç”Ÿéš¨æ©Ÿå¡",
                price: 230,
                image: "https://images.unsplash.com/photo-1614850523296-d8c1af93d400?w=400&q=80",
                description: "â€»éœ€åŒæ™‚è³¼è²·å…¶ä»–å•†å“æ‰èƒ½è³¼å…¥ã€‚æ¯å–®è‡³å¤š4åŒ…ã€‚",
                limit: 4,
                variants: [] 
            },
            {
                id: 4,
                name: "å¥³ç”Ÿéš¨æ©Ÿå¡",
                price: 230,
                image: "https://images.unsplash.com/photo-1614850523296-d8c1af93d400?w=400&q=80",
                description: "â€»éœ€åŒæ™‚è³¼è²·å…¶ä»–å•†å“æ‰èƒ½è³¼å…¥ã€‚æ¯å–®è‡³å¤š10åŒ…ã€‚",
                limit: 10,
                variants: [] 
            }
        ];

        let cart = {}; 
        let productQtyMap = {}; 

        function initApp() {
            const listEl = document.getElementById('productList');
            listEl.innerHTML = '';
            products.forEach(product => {
                const card = document.createElement('div');
                card.className = "bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100";
                
                const descHtml = product.description ? `<div class="product-note">${product.description}</div>` : '';
                const hasVariants = product.variants && product.variants.length > 0;
                let selectionHtml = '';
                
                if (hasVariants) {
                    selectionHtml = `
                        <select id="select-${product.id}" class="w-full border border-gray-200 rounded-lg p-3 bg-gray-50 text-sm font-medium focus:ring-2 focus:ring-blue-500 outline-none">
                            <option value="">-- è«‹é¸æ“‡æ¬¾å¼ --</option>
                            ${product.variants.map(v => `<option value="${v}">${v}</option>`).join('')}
                        </select>`;
                } else {
                    productQtyMap[product.id] = 1;
                    selectionHtml = `
                        <div class="flex items-center justify-between bg-gray-50 p-2 rounded-lg border border-gray-100">
                            <span class="text-sm font-medium text-gray-500 ml-2">æ•¸é‡</span>
                            <div class="qty-control">
                                <button onclick="changeProductQty(${product.id}, -1)" class="qty-btn text-red-500">-</button>
                                <span id="qty-val-${product.id}" class="qty-val">1</span>
                                <button onclick="changeProductQty(${product.id}, 1)" class="qty-btn text-green-500">+</button>
                            </div>
                        </div>`;
                }
                
                card.innerHTML = `
                    <div class="relative"><img src="${product.image}" class="w-full h-44 object-cover"><div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-3 text-right"><p class="text-white font-bold">$${product.price}</p></div></div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg text-gray-800">${product.name}</h3>
                        ${descHtml}
                        <div class="space-y-3 mt-3">
                            ${selectionHtml}
                            <button onclick="addToCart(${product.id})" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold text-sm hover:bg-blue-700 transition-all btn-pop shadow-md shadow-blue-100">ï¼‹ åŠ å…¥è³¼ç‰©è»Š</button>
                        </div>
                    </div>`;
                listEl.appendChild(card);
            });
            ['userName', 'payDate', 'payAmount', 'userIG'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.addEventListener('input', function() { if(this.value.trim() !== "") this.classList.remove('input-error'); });
            });
        }

        function checkLimit(productId, currentInCart, addingQty) {
            const product = products.find(p => p.id == productId);
            if (product && product.limit && (currentInCart + addingQty) > product.limit) {
                alert(`ã€Œ${product.name}ã€æ¯å–®è‡³å¤šè³¼è²· ${product.limit} å€‹ï¼`);
                return false;
            }
            return true;
        }

        function changeProductQty(productId, delta) {
            let current = productQtyMap[productId] || 1;
            const product = products.find(p => p.id == productId);
            const nextValue = current + delta;
            if (nextValue < 1) return;
            if (product.limit && nextValue > product.limit) {
                alert(`æ¯å–®è‡³å¤šè³¼è²· ${product.limit} å€‹ï¼`);
                return;
            }
            productQtyMap[productId] = nextValue;
            document.getElementById(`qty-val-${productId}`).innerText = nextValue;
        }

        function addToCart(productId) {
            const product = products.find(p => p.id == productId);
            const hasVariants = product.variants && product.variants.length > 0;
            let variant = "å–®ä¸€æ¬¾å¼";
            let addQty = 1;

            if (hasVariants) {
                const selectEl = document.getElementById(`select-${productId}`);
                variant = selectEl.value;
                if (!variant) { alert("è«‹å…ˆé¸æ“‡æ¬¾å¼ï¼"); return; }
                selectEl.value = "";
            } else {
                addQty = productQtyMap[productId] || 1;
            }

            const key = `${productId}|${variant}`;
            const currentQty = cart[key] ? cart[key].quantity : 0;

            if (!checkLimit(productId, currentQty, addQty)) return;

            if (!cart[key]) { 
                cart[key] = { productId, variant, quantity: addQty, price: product.price, name: product.name }; 
            } else { 
                cart[key].quantity += addQty; 
            }
            
            if (!hasVariants) {
                productQtyMap[productId] = 1;
                const qtyValEl = document.getElementById(`qty-val-${productId}`);
                if (qtyValEl) qtyValEl.innerText = 1;
            }

            showToast(`å·²åŠ å…¥è³¼ç‰©è»Š`);
            calculateTotal();
            renderCartDetails();
        }

        function updateCartQty(key, delta) {
            if (cart[key]) {
                const item = cart[key];
                if (delta > 0 && !checkLimit(item.productId, item.quantity, delta)) return;
                item.quantity += delta;
                if (item.quantity <= 0) delete cart[key];
            }
            calculateTotal();
            renderCartDetails();
        }

        function toggleCartDetails() { document.getElementById('cartDetails').classList.toggle('hidden'); }

        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = "fixed top-10 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full text-sm font-bold z-[100] shadow-2xl opacity-0 transition-opacity duration-300";
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.style.opacity = "1", 10);
            setTimeout(() => { toast.style.opacity = "0"; setTimeout(() => toast.remove(), 300); }, 2000);
        }

        function renderCartDetails() {
            const listEl = document.getElementById('cartItemsList');
            const detailContainer = document.getElementById('cartDetails');
            const items = Object.values(cart);
            if (items.length === 0) { listEl.innerHTML = '<p class="text-gray-400 text-xs italic py-4 text-center">è³¼ç‰©è»Šç›®å‰æ˜¯ç©ºçš„</p>'; detailContainer.classList.add('hidden'); return; }
            listEl.innerHTML = items.map(item => {
                const key = `${item.productId}|${item.variant}`;
                return `<div class="flex justify-between items-center bg-white p-3 rounded-xl border border-gray-200 shadow-sm">
                    <div class="flex-1"><p class="font-bold text-gray-800 text-sm">${item.name}</p><p class="text-blue-500 text-xs mt-1">${item.variant}</p></div>
                    <div class="flex items-center gap-3">
                        <div class="flex items-center border border-gray-200 rounded-lg overflow-hidden bg-gray-50"><button onclick="updateCartQty('${key}', -1)" class="px-3 py-1 hover:bg-red-50">-</button><span class="w-8 text-center font-bold text-sm">${item.quantity}</span><button onclick="updateCartQty('${key}', 1)" class="px-3 py-1 hover:bg-green-50">+</button></div>
                        <div class="text-right min-w-[70px]"><p class="text-xs font-bold text-gray-600">$${(item.quantity * item.price).toLocaleString()}</p></div>
                    </div></div>`;
            }).join('');
        }

        function calculateTotal() {
            let totalItems = 0, totalPrice = 0;
            Object.values(cart).forEach(item => { totalItems += item.quantity; totalPrice += (item.quantity * item.price); });
            document.getElementById('totalItems').innerText = totalItems;
            document.getElementById('totalPrice').innerText = totalPrice.toLocaleString();
        }

        async function submitOrder() {
            const fields = [{id:'userName'}, {id:'payDate'}, {id:'payAmount'}, {id:'userIG'}];
            let hasError = false;
            fields.forEach(f => { 
                const el = document.getElementById(f.id); 
                if(!el.value.trim()){ el.classList.add('input-error'); hasError = true; } 
            });
            if(hasError){ alert("è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼"); return; }
            
            const orderItems = Object.values(cart);
            if (orderItems.length === 0) { alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼"); return; }

            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerText;
            
            // ç«‹å³é–å®šæŒ‰éˆ•ï¼Œé˜²æ­¢é‡è¤‡æäº¤
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
            submitBtn.innerText = "æäº¤ä¸­...";

            const finalData = {
                timestamp: new Date().toLocaleString(),
                customer: document.getElementById('userName').value,
                payDate: document.getElementById('payDate').value,
                payAmount: document.getElementById('payAmount').value,
                ig: document.getElementById('userIG').value,
                itemsText: orderItems.map(i => `${i.name}(${i.variant}) x${i.quantity}`).join('\n'),
                itemsArray: orderItems,
                total: document.getElementById('totalPrice').innerText
            };

            const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz859c4B5D40bPV53VcJo0VMYgeUY-84Ql8rbl_19Y-NXqDSUZeriGLNnOVf6RWpzPh/exec"; 

            try {
                // ä½¿ç”¨ fetch ä¸¦è¨­å®šè¼ƒçŸ­çš„é€¾æ™‚é‚è¼¯ (GAS æ­£å¸¸è™•ç†ç´„ 2-5 ç§’)
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(finalData)
                });
                
                // no-cors æ¨¡å¼ä¸‹ç„¡æ³•å¾—çŸ¥æ˜¯å¦ 200 OKï¼Œä½†è‹¥ fetch æ²’å ±éŒ¯é€šå¸¸ä»£è¡¨ç™¼é€æˆåŠŸ
                document.getElementById('successModal').classList.remove('hidden');
            } catch (e) {
                console.error("æäº¤å¤±æ•—", e);
                alert("ä¼ºæœå™¨ç¹å¿™æˆ–ç¶²è·¯é€£ç·šå¤±æ•—ï¼Œè«‹ç¨å€™ 10 ç§’å¾Œå†è©¦ä¸€æ¬¡ã€‚");
                // å¤±æ•—æ™‚è§£é–æŒ‰éˆ•è®“ä½¿ç”¨è€…é‡è©¦
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                submitBtn.innerText = originalText;
            }
        }
        window.onload = initApp;
    </script>
</body>
</html>
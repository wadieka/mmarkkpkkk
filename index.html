<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£è³¼è¨‚è³¼è¡¨å–®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .cart-float {
            box-shadow: 0 -10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
        }
        .cart-details-max-h {
            max-height: 250px;
            overflow-y: auto;
        }
        .required-label::after {
            content: " *";
            color: #ef4444;
        }
        .input-error {
            border-color: #ef4444 !important;
            background-color: #fef2f2;
        }
        .btn-pop {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .btn-pop:active {
            transform: scale(0.95);
        }
        .description-text {
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .description-text a {
            color: #2563eb;
            text-decoration: underline;
            font-weight: 600;
        }
        .description-text a:hover {
            color: #1d4ed8;
        }
        .product-note {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.5rem;
            line-height: 1.4;
            background-color: #f9fafb;
            padding: 0.5rem;
            border-radius: 0.5rem;
        }
        .qty-control {
            display: flex;
            align-items: center;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            background: #f9fafb;
        }
        .qty-btn {
            padding: 0.5rem 1rem;
            background: #fff;
            font-weight: bold;
            transition: background 0.2s;
        }
        .qty-btn:hover {
            background: #f3f4f6;
        }
        .qty-val {
            width: 3rem;
            text-align: center;
            font-weight: bold;
            font-size: 0.875rem;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-50 pb-64">
    <div class="max-w-md mx-auto p-4">
        <header class="text-center py-6">
            <h1 class="text-2x2 font-bold text-gray-800">â˜ƒï¸ã€Šmmarkkpkkk_26å¹´4æœˆæ›¸å±•ä»£è³¼è¨‚è³¼å–®ã€‹â˜ƒï¸</h1>
            <div class="description-text text-gray-500 mt-4 text-sm text-left bg-white p-4 rounded-lg border border-dashed border-gray-300">
ã€è¨‚è³¼é ˆçŸ¥ã€‘
ğŸ‘‰ä¸»è¦åƒåŠ 1/24å ´ï¼ŒæœƒæŠ•ç°½å”®
ğŸ‘‰éƒ¨åˆ†å•†å“çš†æœ‰é™åƒ¹ï¼Œè©³ç´°è«‹è¦‹ä¸‹æ–¹é‡‘é¡ã€‚è¿‘æœŸæ³°éŠ–åŒ¯ç‡ä¸ä½³è«‹ç†è§£ã€‚
âœ…äººè‚‰æ‰›å›ï¼Œç„¡é ˆåœ‹éš›é‹è²»ã€‚æ³°åœ‹å“è³ªè«‹ç†è§£ï¼Œä¸å› ä»»ä½•ç‘•ç–µå•é¡Œé€€è²¨ï¼Œè‹¥æœ‰ç¼ºè²¨æƒ…æ³ç™¼ç”Ÿæœƒå…¨é¡é€€æ¬¾ã€‚
âœ…å›åœ‹å¾Œèµ°è³£è²¨ä¾¿20+38ï¼Œä¸å…§é€€ã€‚æœƒä½¿ç”¨äºŒæ‰‹åŒ…æï¼Œä»‹æ„è€…è«‹ç¹é“ã€‚
âœ…å…ˆåŒ¯æ¬¾ï¼Œå¾Œé€å–®ï¼›å¡«å–®å®Œæˆå³è¦–ç‚ºè³¼è²·ï¼Œæ•ä¸å¾—å–æ¶ˆã€‚

ğŸ’°åŒ¯æ¬¾å¸³è™Ÿ:
å°æ–°(812) 28881019124887
ğŸ’°<a href="https://docs.google.com/spreadsheets/d/1cnLagIAqDdCZyUTd6kQZBSekL_c8RvmOwAlxC-LCIOs/edit?gid=917520651#gid=917520651" target="_blank">å°å¸³è¡¨é€£çµé»æˆ‘</a>

ç‚ºæ–¹ä¾¿ç®¡ç†ï¼Œè«‹è·Ÿåœ˜è€…å‹™å¿…åŠ å…¥ç¤¾ç¾¤ï¼Œç¼ºè²¨åˆ°è²¨å‡ºè²¨ç­‰æœ€æ–°æ¶ˆæ¯çš†æœƒæ–¼æ­¤ä¸€ä½µå‘ŠçŸ¥!
ğŸ‘‰<a href="https://line.me/ti/g2/hQDj2h3t7YEkhQtO6zck-48p4Y9nmVumrSja5w?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" target="_blank">é»é€™è£¡åŠ å…¥ç¤¾ç¾¤</a>

æœ‰ä»»ä½•å•é¡Œæ­¡è¿ IG (<a href="https://instagram.com/mmarkkpkkk" target="_blank">mmarkkpkkk</a>) æˆ–ç¤¾ç¾¤ç›´æ¥ @mmarkkpkkkæœ¬äºº
            </div>
        </header>

        <!-- è¯çµ¡è³‡è¨Šå€å¡Š -->
        <section class="bg-white rounded-xl p-4 mb-6 shadow-sm border border-gray-100">
            <h2 class="font-semibold text-lg mb-4 border-b pb-2 text-blue-600">è¯çµ¡è³‡è¨Š (å¿…å¡«)</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-600 mb-1 required-label">å°å¸³è¡¨åç¨±</label>
                    <input type="text" id="userName" placeholder="è«‹è¼¸å…¥æ‚¨çš„åç¨±" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1 required-label">åŒ¯æ¬¾æ—¥æœŸ</label>
                    <input type="text" id="payDate" placeholder="è«‹è¼¸å…¥æ—¥æœŸ (å¦‚: 01/20)" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1 required-label">åŒ¯æ¬¾å¸³è™Ÿå¾Œäº”ç¢¼</label>
                    <input type="text" id="payAccount" placeholder="è«‹è¼¸å…¥å¾Œ 5 ç¢¼" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1 required-label">è¯çµ¡è³‡è¨Š (IG)</label>
                    <input type="text" id="userIG" placeholder="è«‹æä¾›å¯è¯çµ¡çš„å¸³è™Ÿ" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1">å…¶ä»–æ¬²å‚™è¨»äº‹é …</label>
                    <input type="text" id="memo" placeholder=" " class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                </div>
            </div>
        </section>

        <!-- å•†å“è³‡è¨Šå€å¡Š -->
        <div id="productList" class="space-y-6"></div>

        <!-- æœ€çµ‚æé†’äº‹é …å€å¡Š -->
        <section class="mt-8 mb-4">
            <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
                <h4 class="text-yellow-800 font-bold text-sm mb-2 flex items-center gap-1">
                    <span>âš ï¸</span> æäº¤å‰è«‹æœ€å¾Œç¢ºèª
                </h4>
                <ul class="text-xs text-yellow-700 space-y-1 list-disc pl-4">
                    <li>è«‹ç¢ºèª<strong>å•†å“å…§å®¹èˆ‡æ¬¾å¼</strong>çš†æ­£ç¢ºã€‚</li>
                    <li>è«‹ç¢ºèª<strong>åŒ¯æ¬¾é‡‘é¡</strong>èˆ‡<strong>è³¼ç‰©è»Šç¸½è¨ˆé‡‘é¡</strong>ç›¸ç¬¦ã€‚</li>
                    <li>è«‹å‹™å¿…<strong>åŒ¯æ¬¾å®Œæˆå¾Œæ‰æäº¤è¨‚å–®</strong>ã€‚</li>
                    <ul>ğŸ’°åŒ¯æ¬¾å¸³è™Ÿ:å°æ–°(812) 28881019124887</ul>                    
                    <li>è¨‚å–®å®Œæˆå¾Œï¼Œå¯è‡³<a href="https://docs.google.com/spreadsheets/d/1cnLagIAqDdCZyUTd6kQZBSekL_c8RvmOwAlxC-LCIOs/edit?gid=917520651#gid=917520651" target="_blank">å°å¸³è¡¨</a>ç¢ºèªå…¥å¸³æƒ…æ³åŠè³¼è²·å•†å“</li>
                </ul>
            </div>
        </section>

        <div class="fixed bottom-0 left-0 right-0 bg-white cart-float border-t z-40">
            <div id="cartDetails" class="max-w-md mx-auto px-4 py-3 border-b bg-gray-50 hidden">
                <div class="flex justify-between items-center mb-2">
                    <p class="text-xs font-bold text-gray-500 uppercase tracking-wider">å·²åŠ å…¥è³¼ç‰©è»Šï¼š</p>
                    <button onclick="toggleCartDetails()" class="text-gray-400 text-xs">æ”¶èµ· âœ•</button>
                </div>
                <div id="cartItemsList" class="cart-details-max-h space-y-2 mb-2"></div>
            </div>

            <div class="max-w-md mx-auto p-4 flex items-center justify-between">
                <div class="flex-1">
                    <p class="text-sm text-gray-500 flex items-center gap-1">
                        ç¸½è¨ˆ <span id="totalItems" class="text-blue-600 font-bold">0</span> ä»¶å•†å“
                        <button onclick="toggleCartDetails()" class="text-blue-500 text-xs underline ml-2">æ˜ç´°</button>
                    </p>
                    <p class="text-xl font-bold text-red-500">ç¸½é‡‘é¡: $<span id="totalPrice">0</span></p>
                </div>
                <button id="submitBtn" onclick="submitOrder()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-xl font-bold transition-all btn-pop shadow-lg shadow-blue-200">
                    æäº¤è¨‚å–®
                </button>
            </div>
        </div>

        <div id="loadingOverlay" class="fixed inset-0 bg-black/70 flex flex-col items-center justify-center hidden z-[60] p-6 text-center">
            <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin-slow mb-4"></div>
            <h3 class="text-white text-xl font-bold mb-2">è¨‚å–®é€å‡ºä¸­...</h3>
            <p class="text-blue-200 text-sm">è«‹ä¸è¦é‡æ–°æ•´ç†é é¢ã€‚</p>
        </div>

        <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
            <div class="bg-white p-8 rounded-2xl text-center max-w-sm w-full shadow-2xl">
                <div class="w-20 h-20 bg-green-100 text-green-500 rounded-full flex items-center justify-center text-5xl mx-auto mb-4">âœ“</div>
                <h3 class="text-xl font-bold mb-2">è¨‚å–®æäº¤æˆåŠŸï¼</h3>
                <button onclick="location.reload()" class="w-full bg-blue-600 text-white px-6 py-3 rounded-xl font-bold">è¿”å›é¦–é </button>
            </div>
        </div>
    </div>

    <script>
        const products = [
            { id: 1, name: "å¨ƒ", price: 999, image: "https://i.ibb.co/k2YkHDmd/image.jpg", variants: ["KING MAN", "BABII", "POLCASAN", "MR. SATURNWORLD", "PAODY", "PERMPOON", "TOMAFOX", "JAIDEE", "AVOCEAN", "YUZU MUMU", "LOOK KHUNNOO", "SAMRUAY", "NONG NOOONG", "DOMIIA", "WESLEY", "JUMMO", "GUINZLY", "MOMO", "CERI", "MUVMUV", "LUNAR", "ANY", "METAA", "NILKNHAKE", "SMYLE", "NEONA", "LYKYOU"] },
            { id: 2, name: "äºº", price: 450, image: "https://i.ibb.co/JF5DYWQ6/image.jpg", variants: ["KristSingto", "OffGun", "TayNew", "EarthMix", "BounPrem", "PondPhuwin", "ForceBook", "JoongDunk", "JimmySea", "FirstKhaotung", "GeminiFourth", "WinnySatang", "SeaKeen", "PerthSanta", "WilliamEst", "JuniorMark", "JossGawin", "MarkOhm", "AouBoom","AlmondProgress","OhmPoon","LukeMick", "ChokunAston","SaveFranc","SurfJava", "MilkLove", "NamtanFilm", "EmiBonnie", "Win", "Nanon", "Sky", "Nani", "LYKN"] }, 
            { id: 3, name: "ç”·ç”Ÿéš¨æ©Ÿå¡", price: 230, image: "https://images.unsplash.com/photo-1614850523296-d8c1af93d400?w=400&q=80", description: "â€»é ˆè³¼è²·å…¶ä»–å•†å“æ‰èƒ½åŠ è³¼ï¼Œæ¯å–®è‡³å¤š4åŒ…ã€‚", limit: 4, variants: [] },
            { id: 4, name: "å¥³ç”Ÿéš¨æ©Ÿå¡", price: 230, image: "https://images.unsplash.com/photo-1614850523296-d8c1af93d400?w=400&q=80", description: "â€»é ˆè³¼è²·å…¶ä»–å•†å“æ‰èƒ½åŠ è³¼ï¼Œæ¯å–®è‡³å¤š10åŒ…ã€‚", limit: 10, variants: [] },
         ];

        let cart = {}; 
        let productQtyMap = {}; 

        function initApp() {
            const listEl = document.getElementById('productList');
            listEl.innerHTML = '';
            products.forEach(product => {
                const card = document.createElement('div');
                card.className = "bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100";
                const hasVariants = product.variants && product.variants.length > 0;
                let selectionHtml = hasVariants ? 
                    `<select id="select-${product.id}" class="w-full border border-gray-200 rounded-lg p-3 bg-gray-50 text-sm focus:ring-2 focus:ring-blue-500 outline-none"><option value="">-- æ¬¾å¼ --</option>${product.variants.map(v => `<option value="${v}">${v}</option>`).join('')}</select>` :
                    `<div class="flex items-center justify-between bg-gray-50 p-2 rounded-lg"><span class="text-sm font-medium text-gray-500 ml-2">æ•¸é‡</span><div class="qty-control"><button onclick="changeProductQty(${product.id}, -1)" class="qty-btn text-red-500">-</button><span id="qty-val-${product.id}" class="qty-val">1</span><button onclick="changeProductQty(${product.id}, 1)" class="qty-btn text-green-500">+</button></div></div>`;
                
                card.innerHTML = `
                    <div class="relative"><img src="${product.image}" class="w-full h-44 object-cover"><div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-3 text-right"><p class="text-white font-bold">$${product.price}</p></div></div>
                    <div class="p-4"><h3 class="font-bold text-lg text-gray-800">${product.name}</h3>${product.description ? `<div class="product-note">${product.description}</div>` : ''}<div class="space-y-3 mt-3">${selectionHtml}<button onclick="addToCart(${product.id})" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold text-sm hover:bg-blue-700 transition-all btn-pop">ï¼‹ åŠ å…¥è³¼ç‰©è»Š</button></div></div>`;
                listEl.appendChild(card);
            });
            ['userName', 'payDate', 'payAccount', 'userIG'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.addEventListener('input', function() { if(this.value.trim() !== "") this.classList.remove('input-error'); });
            });
        }

        function changeProductQty(productId, delta) {
            let current = productQtyMap[productId] || 1;
            const product = products.find(p => p.id == productId);
            const nextValue = current + delta;
            if (nextValue < 1 || (product.limit && nextValue > product.limit)) return;
            productQtyMap[productId] = nextValue;
            document.getElementById(`qty-val-${productId}`).innerText = nextValue;
        }

        function addToCart(productId) {
            const product = products.find(p => p.id == productId);
            const hasVariants = product.variants && product.variants.length > 0;
            let variant = "å–®ä¸€";
            let addQty = 1;
            if (hasVariants) {
                variant = document.getElementById(`select-${productId}`).value;
                if (!variant) { alert("è«‹é¸æ“‡æ¬¾å¼ï¼"); return; }
                document.getElementById(`select-${productId}`).value = "";
            } else {
                addQty = productQtyMap[productId] || 1;
            }
            const key = `${productId}|${variant}`;
            if (product.limit && ((cart[key]?.quantity || 0) + addQty) > product.limit) { alert("è¶…å‡ºé™è³¼ï¼"); return; }
            if (!cart[key]) cart[key] = { ...product, variant, quantity: 0 };
            cart[key].quantity += addQty;
            calculateTotal();
            renderCartDetails();
            showToast("å·²åŠ å…¥è³¼ç‰©è»Š");
        }

        function renderCartDetails() {
            const listEl = document.getElementById('cartItemsList');
            const items = Object.values(cart);
            listEl.innerHTML = items.map(item => `<div class="flex justify-between items-center bg-white p-3 rounded-xl border border-gray-200 shadow-sm"><div class="flex-1"><p class="font-bold text-sm text-gray-800">${item.name}</p><p class="text-blue-500 text-xs">${item.variant}</p></div><div class="flex items-center gap-3"><div class="flex items-center border rounded-lg bg-gray-50"><button onclick="updateCartQty('${item.id}|${item.variant}', -1)" class="px-2 py-1">-</button><span class="w-6 text-center text-sm font-bold">${item.quantity}</span><button onclick="updateCartQty('${item.id}|${item.variant}', 1)" class="px-2 py-1">+</button></div><p class="text-xs font-bold w-16 text-right">$${(item.quantity * item.price).toLocaleString()}</p></div></div>`).join('');
        }

        function updateCartQty(key, delta) {
            if (cart[key]) {
                const product = products.find(p => p.id == cart[key].id);
                if (delta > 0 && product.limit && cart[key].quantity >= product.limit) return;
                cart[key].quantity += delta;
                if (cart[key].quantity <= 0) delete cart[key];
            }
            calculateTotal();
            renderCartDetails();
        }

        function calculateTotal() {
            let items = 0, price = 0;
            Object.values(cart).forEach(i => { items += i.quantity; price += (i.quantity * i.price); });
            document.getElementById('totalItems').innerText = items;
            document.getElementById('totalPrice').innerText = price.toLocaleString();
        }

        function toggleCartDetails() { document.getElementById('cartDetails').classList.toggle('hidden'); }
        function showToast(m) { const t = document.createElement('div'); t.className = "fixed top-10 left-1/2 -translate-x-1/2 bg-black text-white px-4 py-2 rounded-full text-xs z-[100]"; t.innerText = m; document.body.appendChild(t); setTimeout(() => t.remove(), 2000); }

        async function submitOrder() {
            const required = ['userName', 'payDate', 'payAccount', 'userIG'];
            let err = false;
            required.forEach(id => { const el = document.getElementById(id); if(!el.value.trim()){ el.classList.add('input-error'); err = true; } });
            
            const cartArray = Object.values(cart);
            if(err || cartArray.length === 0){ alert("è«‹å¡«å¯«å¿…å¡«æ¬„ä½æˆ–è³¼ç‰©è»Šï¼"); return; }

            const submitBtn = document.getElementById('submitBtn');
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.remove('hidden');
            submitBtn.disabled = true;

            const finalData = {
                timestamp: new Date().toLocaleString(),
                customer: document.getElementById('userName').value,
                payDate: document.getElementById('payDate').value,
                payAccount: document.getElementById('payAccount').value, 
                ig: document.getElementById('userIG').value,
                memo: document.getElementById('memo').value || "", 
                itemsText: cartArray.map(i => `${i.name}(${i.variant}) x${i.quantity}`).join('\n'),
                itemsArray: cartArray,
                total: document.getElementById('totalPrice').innerText
            };

            const URL = "https://script.google.com/macros/s/AKfycbz859c4B5D40bPV53VcJo0VMYgeUY-84Ql8rbl_19Y-NXqDSUZeriGLNnOVf6RWpzPh/exec";
            try {
                await fetch(URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(finalData) });
                overlay.classList.add('hidden');
                document.getElementById('successModal').classList.remove('hidden');
            } catch (e) {
                alert("æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šå¾Œé‡è©¦ã€‚");
                overlay.classList.add('hidden');
                submitBtn.disabled = false;
            }
        }
        window.onload = initApp;
    </script>
</body>
</html>
